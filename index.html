<html>

<head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <style>
        svg {
            width: 200 !important;
            height: 200 !important;
        }
    </style>
</head>

<body>
    <script type="module">
        import init, { run } from './pkg/qrtransfer.js';
        await init();
        window.run = run
    </script>

    <input type="file" id="file-selector">
    <script>
        const fileSelector = document.getElementById("file-selector")
        function read_file_content(ev) {
            progress_div = document.getElementById("progress")
            progress_div.innerText = "Processing..."


            const reader = new FileReader();
            reader.addEventListener('load', (ev) => {
                buffer = event.target.result
                int_array = Array.from(new Uint8Array(buffer))
                file_name = fileSelector.files[0].name
                window.run(file_name, int_array)
                progress_div.innerText = "Finished."
            });
            reader.readAsArrayBuffer(fileSelector.files[0])
        }

        document.getElementById("file-selector").addEventListener("change", read_file_content)
    </script>
    <div id="progress"></div>
    <div id="qrcode"></div>
    <script>
        function receive() {
            let bytes = [65, 108, 105, 99, 101, 39, 115, 32, 65, 100, 118, 101, 110, 116, 117, 114, 101];

            let base64data = btoa(String.fromCharCode.apply(null, bytes));

            let a = document.createElement('a');
            a.href = 'data:;base64,' + base64data;
            a.download = 'binFile.txt';
            a.click();
        }
    </script>
    <button onclick="receive()">receive</button>
</body>

</html>